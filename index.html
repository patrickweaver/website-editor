<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Website</title>
    
    <!-- CSS -->
    <style>
      body {
        font-family: "Arial", sans-serif;
        background-color: plum;
        margin: 2rem;
      }
    </style>
    
    
  </head>
  <body>
  
    <h1>Website</h1>

    <h2>About Me</h2>

    <p>I can update this website in my browser.</p>

    <!-- Local Controls -->
    <div id="local-controls" style="display: none">
      <button id="save-changes">Save Changes</button>
    </div>
  
    <!-- JS -->
    <script type="text/javascript">

      // Text
      document
        .querySelectorAll("h1, h2, h3, h4, h5, h6, p")
        .forEach(function(node) {
          node
            .addEventListener("click", function(event) {
              const node = event.target;
              const content = node.innerHTML;
              let inputNode = document.createElement("input");
              inputNode.type = "text";
              inputNode.value = content;
              node.parentElement.insertBefore(inputNode, node);
              let buttonNode = document.createElement("button");
              buttonNode.innerHTML = "Save";
              node.parentElement.insertBefore(buttonNode, node);
              const originalDisplay = node.style.display;
              node.style.display = "none";
              buttonNode
                .addEventListener("click", function(event) {
                  node.innerHTML = inputNode.value;
                  inputNode.remove();
                  buttonNode.remove();
                  node.style.display = originalDisplay;
                })
            })
        })

      /*
       * Show Local Controls Locally
       */

      const protocol = window.location.protocol;
      if (protocol === "file:") {
        document.getElementById("local-controls")
          .style.display = "block";
      }


      /*
       * Save Changes
       */
      
      document
        .getElementById("save-changes")
        .addEventListener("click", function(event) {
          console.log("click")
          const htmlSourceCode = `
            <html lang="en">
              ${document.head.innerHTML}
              ${document.body.innerHTML}
            </html>
          `
          saveFile(htmlSourceCode)
        })

      // Chromium only
      // https://developer.mozilla.org/en-US/docs/Web/API/FileSystemWritableFileStream/write
      async function saveFile(data) {
        // create a new handle
        const newHandle = await window.showSaveFilePicker({
          startIn: "desktop",
          suggestedName: "index.html",
          types: [{
            description: 'HTML',
            accept: {
              "text/markdown": [".html"],
            }
          }]
        });

        // create a FileSystemWritableFileStream to write to
        const writableStream = await newHandle.createWritable();

        // write our file
        await writableStream.write(data);

        // close the file and write the contents to disk.
        await writableStream.close();
      }

    </script>
  </body>
</html>